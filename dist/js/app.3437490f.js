(function(t){function e(e){for(var a,r,i=e[0],c=e[1],l=e[2],u=0,h=[];u<i.length;u++)r=i[u],Object.prototype.hasOwnProperty.call(n,r)&&n[r]&&h.push(n[r][0]),n[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);d&&d(e);while(h.length)h.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var t,e=0;e<o.length;e++){for(var s=o[e],a=!0,i=1;i<s.length;i++){var c=s[i];0!==n[c]&&(a=!1)}a&&(o.splice(e--,1),t=r(r.s=s[0]))}return t}var a={},n={app:0},o=[];function r(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=a,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(s,a,function(e){return t[e]}.bind(null,a));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=e,i=i.slice();for(var l=0;l<i.length;l++)e(i[l]);var d=c;o.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"46ac":function(t,e,s){},"49b9":function(t,e,s){"use strict";s("686a")},"56d7":function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("nav",{class:{active:t.showMenu},attrs:{id:"menubar"},on:{click:function(e){t.showMenu=!1}}},[t._m(0),s("ul",[s("li",[s("router-link",{attrs:{to:"/"}},[s("span",{staticClass:"icon"},[s("grid-icon")],1),s("span",{staticClass:"text"},[t._v("Dashboard")])])],1),s("li",[s("router-link",{attrs:{to:"/sensors"}},[s("span",{staticClass:"icon"},[s("thermometer-icon")],1),s("span",{staticClass:"text"},[t._v("Sensors")])])],1),s("li",[s("router-link",{attrs:{to:"/account"}},[s("span",{staticClass:"icon"},[s("user-icon")],1),s("span",{staticClass:"text"},[t._v("Account")])])],1),s("li",[s("router-link",{attrs:{to:"/logout"}},[s("span",{staticClass:"icon"},[s("log-out-icon")],1),s("span",{staticClass:"text"},[t._v("Logout")])])],1)])]),s("div",{attrs:{id:"main"}},[s("router-view")],1)])},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"menu-brand"}},[s("h2",{staticClass:"centered"},[t._v("Wine Sense")])])}],r=s("0a35"),i={name:"App",components:{MenuIcon:r["e"],GridIcon:r["c"],ThermometerIcon:r["f"],UserIcon:r["h"],LogOutIcon:r["d"]},data(){return{showMenu:!1}}},c=i,l=(s("cf25"),s("2877")),d=Object(l["a"])(c,n,o,!1,null,null,null),u=d.exports,h=s("8c4f"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TopBar",{attrs:{buttons:t.buttons,title:"Dashboard"}}),s("div",{attrs:{id:"content"}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-xs-12 col-lg-8"},[s("div",{staticClass:"card has-chart"},[s("chartist",{attrs:{ratio:"ct-major-second",type:"Line",data:t.chartData,options:t.chartOptions}})],1)]),t._m(0)])])],1)},v=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col-xs-12 col-lg-4"},[s("div",{staticClass:"card"},[t._v("This is some content")])])}],f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("nav",{staticClass:"row",attrs:{id:"topbar"}},[s("div",{staticClass:"col-xs nogrow burger"},[s("chevron-right-icon",{on:{click:t.showMenu}})],1),s("div",{staticClass:"col-xs content-left"},[s("h3",[t._v(t._s(t.title))])]),s("div",{staticClass:"col-xs content-right"},t._l(t.buttons,(function(e){return s("button",{staticClass:"button",attrs:{disabled:e.disabled},on:{click:e.method}},[t._v(t._s(e.name))])})),0)])},b=[],g={name:"TopBar",components:{MenuIcon:r["e"],ChevronRightIcon:r["b"]},props:["buttons","title"],methods:{showMenu(){this.$parent.$parent.showMenu=!0}}},m=g,_=(s("5953"),Object(l["a"])(m,f,b,!1,null,"7a8ff8d5",null)),w=_.exports,C={components:{TopBar:w},name:"Dashboard",data(){return{buttons:[],chartData:{labels:["A","B","C"],series:[[1,3,2],[4,6,5]]},chartOptions:{lineSmooth:!1}}}},x=C,S=Object(l["a"])(x,p,v,!1,null,null,null),y=S.exports,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TopBar",{attrs:{buttons:t.buttons,title:"Sensors"}}),s("div",{attrs:{id:"content"}},[t.errorMessage?s("div",{staticClass:"message danger"},[s("h1",[t._v("No Bluetooth Support")]),s("p",[t._v("Your current web browser does not support bluetooth. Please use a Chromium-based browser (Google Chrome, Brave, Chromium) or Opera to add sensors")])]):t._e(),t.experimentalMessage?s("div",{staticClass:"message warning"},[s("h1",[t._v("Experimental Support for Chromium on Linux")]),s("p",[t._v('Your browser has experimental support for detecting bluetooth devices. To enable it, open a new tab with this link and change the value "Default" to "Enabled" and click "Reload" when prompted.')]),s("a",{attrs:{href:"chrome://flags/#enable-experimental-web-platform-features"}},[t._v("chrome://flags/#enable-experimental-web-platform-features")])]):t._e(),t.btData.networks.length>0?s("div",{staticClass:"message add"},[s("h2",[t._v("Add Sensor")]),s("p",[t._v("ID: "+t._s(t.btData.identifier))]),""===t.addSensorData.ssid?s("ul",{staticClass:"nets"},t._l(t.btData.networks,(function(e){return s("li",[s("div",{staticClass:"row middle-xs"},[s("div",{staticClass:"col-xs nogrow"},[s("WiFiIcon",{attrs:{strength:e.strength}})],1),s("div",{staticClass:"col-xs"},[s("span",[t._v(t._s(e.ssid))])]),0===e.security?s("div",{staticClass:"col-xs nogrow"},[s("alert-circle-icon")],1):t._e(),s("div",{staticClass:"col-xs nogrow"},[s("a",{staticClass:"button sm",on:{click:function(s){return t.setWiFi(e.ssid)}}},[t._v("Select")])])])])})),0):t._e(),""!==t.addSensorData.ssid?s("div",{staticClass:"connect"},[s("form",[s("fieldset",[s("label",{attrs:{for:"ssid"}},[t._v("SSID")]),s("input",{directives:[{name:"model",rawName:"v-model:value",value:t.addSensorData.ssid,expression:"addSensorData.ssid",arg:"value"}],attrs:{name:"ssid",readonly:""},domProps:{value:t.addSensorData.ssid},on:{input:function(e){e.target.composing||t.$set(t.addSensorData,"ssid",e.target.value)}}})]),s("fieldset",[s("label",{attrs:{for:"key"}},[t._v("Network Key")]),s("input",{directives:[{name:"model",rawName:"v-model:value",value:t.addSensorData.key,expression:"addSensorData.key",arg:"value"}],attrs:{name:"key"},domProps:{value:t.addSensorData.key},on:{input:function(e){e.target.composing||t.$set(t.addSensorData,"key",e.target.value)}}})]),s("a",{staticClass:"button",on:{click:t.connectWiFi}},[t._v("Connect")])])]):t._e()]):t._e(),0===t.btData.networks.length?s("div",{staticClass:"row"},[0==t.sensors.length?s("div",{staticClass:"col-xs-12"},[t._m(0)]):t._e()]):t._e()])],1)},k=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message warning"},[s("h3",{staticClass:"message-title"},[t._v("No Sensors")]),s("p",[t._v("You don't have any sensors, add one!")])])}],O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("i",{staticClass:"icon__signal-strength",class:t.classObject},[s("span",{staticClass:"bar-1"}),s("span",{staticClass:"bar-2"}),s("span",{staticClass:"bar-3"}),s("span",{staticClass:"bar-4"})])},j=[],M={name:"WiFiIcon",props:["strength"],computed:{classObject:function(){return{"signal-0":0===this.strength,"signal-1":1===this.strength,"signal-2":2===this.strength,"signal-3":3===this.strength,"signal-4":4===this.strength}}}},T=M,E=(s("7e37"),Object(l["a"])(T,O,j,!1,null,null,null)),$=E.exports;const I="45ce3e18-db8e-40e3-883d-914a682ac2bf",A="cc53dab2-a3cc-43f1-bf68-809960776f94",P="c3187642-322f-4c8b-8845-d6720def4a5c",B="8bc76349-0cb6-4e1a-bba5-90fa7e65c6ad";var N={components:{TopBar:w,WiFiIcon:$,UnlockIcon:r["g"],AlertCircleIcon:r["a"]},name:"Sensors",data(){const t=!!this.bluetooth;return{buttons:[{name:"Add Sensor",method:this.sensorSearch,disabled:!t}],navigator:window.navigator,experimentalMessage:!1,errorMessage:!1,sensors:[],btData:{networks:[],characteristic:null,identifier:""},addSensorData:{ssid:"",key:""},device_id_char:null}},created(){this.bluetooth||(this.navigator.platform.includes("Linux")&&this.navigator.userAgentData&&this.navigator.userAgentData.brands.forEach(t=>{"Chromium"===t.brand&&(this.experimentalMessage=!0)}),0==this.experimentalMessage&&(this.errorMessage=!0))},methods:{async sensorSearch(){console.log("Add Sensor");const t=await this.bluetooth.requestDevice({filters:[{name:"Wine Sense"}],optionalServices:[I]}),e=await t.gatt.connect(),s=await e.getPrimaryService(I);console.log(s);let a=await s.getCharacteristic(A);await a.startNotifications(),a.addEventListener("characteristicvaluechanged",t=>{const e=new TextDecoder("utf-8"),s=e.decode(t.target.value),a=JSON.parse(s);a.hasOwnProperty("state")?"failed"===a.state?console.log("Password incorrect / unable to connect"):(console.log("Success!"),this.addDevice()):console.log("Unknown error")});const n=await a.getDescriptor(P);let o=await n.readValue();const r=new TextDecoder("utf-8"),i=r.decode(o).split("|").map(t=>({strength:t.substr(0,1),security:t.substr(1,1),ssid:t.substr(2)}));this.btData.characteristic=a,this.btData.networks=i,this.device_id_char=await s.getCharacteristic(B),o=await this.device_id_char.readValue(),console.log("id",r.decode(o)),this.btData.identifier=r.decode(o)},setWiFi(t){this.addSensorData.ssid=t},connectWiFi(){let t=JSON.stringify({ssid:this.addSensorData.ssid,key:this.addSensorData.key});console.log(t),this.btData.characteristic.writeValue((new TextEncoder).encode(t+"\n"))},addDevice(){console.log("Adding device to server");const t=JSON.stringify({id:this.btData.identifier,user:"9091a5c8-a382-4449-91c5-a4aa87b1cb62"});console.log(t),fetch("/api/device",{method:"post",body:t,headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{console.log(t);let e=JSON.stringify({user:"9091a5c8-a382-4449-91c5-a4aa87b1cb62",otp:t.otp,url:window.location.origin+"/api/device/register",endpoint:window.location.origin});this.device_id_char.writeValue((new TextEncoder).encode(e+"\n"))})}}},W=N,F=(s("49b9"),Object(l["a"])(W,D,k,!1,null,"fd6e1cb2",null)),J=F.exports,L=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("TopBar",{attrs:{buttons:t.buttons,title:"Account"}}),t._m(0)],1)},V=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"content"}},[s("h2",[t._v("Account!")])])}],U={components:{TopBar:w},name:"Account",data(){return{buttons:[]}}},Y=U,G=Object(l["a"])(Y,L,V,!1,null,"193f9899",null),R=G.exports;a["a"].use(h["a"]),a["a"].use(s("84b5")),a["a"].prototype.bluetooth=window.navigator.bluetooth;const q=[{path:"/",component:y},{path:"/sensors",component:J},{path:"/account",component:R},{path:"/logout",component:y}],K=new h["a"]({routes:q});new a["a"]({router:K,render:t=>t(u)}).$mount("#app")},5953:function(t,e,s){"use strict";s("84a2")},"686a":function(t,e,s){},"7e37":function(t,e,s){"use strict";s("46ac")},"84a2":function(t,e,s){},cf25:function(t,e,s){"use strict";s("fea6")},fea6:function(t,e,s){}});
//# sourceMappingURL=app.3437490f.js.map